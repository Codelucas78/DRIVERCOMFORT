<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš— Transporte Premium - Lucas Santos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .star {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(219, 39, 119, 0.8); }
        }

        #chatMessages {
            max-height: 400px;
            overflow-y: auto;
        }

        #chatMessages::-webkit-scrollbar {
            width: 8px;
        }

        #chatMessages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        #chatMessages::-webkit-scrollbar-thumb {
            background: rgba(147, 51, 234, 0.5);
            border-radius: 10px;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .suggestion-item {
            transition: all 0.2s ease;
        }

        .loading-pulse {
            animation: loading-pulse 1.5s ease-in-out infinite;
        }

        @keyframes loading-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-8">
        
        <!-- Header Premium -->
        <div class="glass rounded-3xl p-8 shadow-2xl animate-float">
            <div class="flex flex-col md:flex-row items-center gap-6">
                <div class="relative">
                    <div class="w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 p-1 pulse-glow">
                        <div class="w-full h-full rounded-full bg-gray-800 flex items-center justify-center overflow-hidden">
                            <img id="fotoMotorista" src="" alt="Foto" class="w-full h-full object-cover hidden">
                            <span id="avatarPadrao" class="text-5xl">ğŸ‘¨â€ğŸ’¼</span>
                        </div>
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-green-500 w-8 h-8 rounded-full border-4 border-gray-900 flex items-center justify-center">
                        <span class="text-xs">âœ“</span>
                    </div>
                </div>
                
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-4xl font-bold text-white mb-2">Lucas Santos</h1>
                    <p class="text-xl text-purple-200 mb-3">ğŸš— Motorista Premium Profissional</p>
                    <div class="flex flex-wrap justify-center md:justify-start gap-3">
                        <span class="px-4 py-2 bg-purple-600/50 rounded-full text-sm text-white font-semibold">
                            <span class="star">â­â­â­â­â­</span> 5.0
                        </span>
                        <span class="px-4 py-2 bg-pink-600/50 rounded-full text-sm text-white font-semibold">
                            ğŸ† 1.247 Corridas
                        </span>
                        <span class="px-4 py-2 bg-blue-600/50 rounded-full text-sm text-white font-semibold">
                            âœ… Verificado
                        </span>
                    </div>
                </div>

                <button onclick="toggleAdmin()" class="px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white rounded-xl font-bold transition-all duration-300 shadow-lg">
                    âš™ï¸ Admin
                </button>
            </div>
        </div>

        <!-- FormulÃ¡rio de Viagem -->
        <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-6">
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                        ğŸ—ºï¸ Planejar Viagem
                    </h2>

                    <div class="glass p-6 rounded-2xl mb-4">
                        <label class="block text-gray-200 font-semibold mb-3">ğŸ“ De onde vocÃª estÃ¡?</label>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="origem" 
                                placeholder="Digite o endereÃ§o de origem..."
                                class="w-full px-4 py-4 rounded-xl bg-white/10 border-2 border-purple-400/30 text-white placeholder-gray-400 focus:border-purple-500 focus:outline-none transition-all"
                                autocomplete="off"
                                oninput="buscarSugestoesOrigem(this.value)"
                            >
                            <div id="sugestoesOrigem" class="absolute w-full mt-2 glass rounded-xl overflow-hidden shadow-2xl z-50 hidden max-h-80 overflow-y-auto"></div>
                        </div>
                        <button 
                            onclick="obterLocalizacao()" 
                            class="mt-3 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-cyan-500/50 w-full"
                        >
                            ğŸ“ Usar Minha LocalizaÃ§Ã£o Atual
                        </button>
                        <div id="locationStatus" class="hidden"></div>
                    </div>

                    <div class="glass p-6 rounded-2xl mb-4">
                        <label class="block text-gray-200 font-semibold mb-3">ğŸ¯ Para onde vocÃª vai?</label>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="destino" 
                                placeholder="Ex: Jardim Camburi, VitÃ³ria - ES"
                                class="w-full px-4 py-4 rounded-xl bg-white/10 border-2 border-pink-400/30 text-white placeholder-gray-400 focus:border-pink-500 focus:outline-none transition-all"
                                autocomplete="off"
                                oninput="buscarSugestoesDestino(this.value)"
                            >
                            <div id="sugestoesDestino" class="absolute w-full mt-2 glass rounded-xl overflow-hidden shadow-2xl z-50 hidden max-h-80 overflow-y-auto"></div>
                        </div>
                    </div>

                    <button 
                        onclick="calcularRota()" 
                        class="w-full px-8 py-5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-xl font-bold rounded-2xl transition-all duration-300 shadow-2xl hover:shadow-purple-500/50 pulse-glow"
                    >
                        ğŸ’ Calcular Valor da Viagem
                    </button>

                    <div class="flex gap-3 mt-4">
                        <button 
                            onclick="abrirGoogleMaps()" 
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-300 shadow-lg"
                        >
                            ğŸ—ºï¸ Google Maps
                        </button>
                        <button 
                            onclick="abrirWaze()" 
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-xl font-semibold transition-all duration-300 shadow-lg"
                        >
                            ğŸš— Waze
                        </button>
                    </div>
                </div>

                <div id="resultadoPreco" class="hidden glass p-6 rounded-2xl space-y-4">
                    <h3 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                        ğŸ’ Detalhes da Viagem
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-4 bg-white/5 rounded-xl">
                            <span class="text-gray-300">ğŸ“ DistÃ¢ncia:</span>
                            <span id="distanciaTexto" class="text-xl font-bold text-white loading-pulse">Calculando...</span>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-white/5 rounded-xl">
                            <span id="taxaDescricao" class="text-gray-300">ğŸ’° Valor por km:</span>
                            <span id="valorKm" class="text-xl font-bold text-white">R$ --</span>
                        </div>
                        
                        <div class="flex justify-between items-center p-6 bg-gradient-to-r from-purple-600/30 to-pink-600/30 rounded-xl border-2 border-purple-400/50">
                            <span class="text-xl font-bold text-white">ğŸ’³ Valor Total:</span>
                            <span id="valorTotal" class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-400">R$ --</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border border-blue-400/30 rounded-xl p-4 mt-4">
                        <p class="text-sm text-blue-200">
                            â„¹ï¸ <strong>InformaÃ§Ã£o:</strong> Valores dentro do EspÃ­rito Santo: R$ 3,00/km. Viagens para outros estados: R$ 4,00/km. Pagamento direto ao motorista ou PIX.
                        </p>
                    </div>
                </div>

                <div id="secaoPagamento" class="hidden glass p-6 rounded-2xl space-y-4">
                    <h3 class="text-2xl font-bold text-white mb-4">ğŸ’³ OpÃ§Ã£o de Pagamento PIX</h3>
                    
                    <div class="bg-gradient-to-r from-green-600/20 to-emerald-600/20 border border-green-400/30 rounded-xl p-5">
                        <p class="text-green-200 mb-3">
                            <strong>Chave PIX (CPF):</strong>
                        </p>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                value="147.122.587-99" 
                                readonly 
                                class="flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white font-mono text-lg"
                            >
                            <button 
                                onclick="copiarPix()" 
                                class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-semibold transition-all"
                            >
                                ğŸ“‹ Copiar
                            </button>
                        </div>
                        <p class="text-sm text-gray-300 mt-3">
                            ğŸ’° Valor: <span id="valorPagamento" class="font-bold text-green-400">R$ --</span>
                        </p>
                    </div>

                    <button 
                        onclick="confirmarPagamento()" 
                        class="w-full px-6 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white text-lg font-bold rounded-xl transition-all shadow-lg"
                    >
                        âœ… Confirmar Pagamento PIX
                    </button>
                </div>

                <button 
                    id="btnWhatsApp"
                    onclick="enviarWhatsApp()" 
                    class="hidden w-full px-8 py-5 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white text-xl font-bold rounded-2xl transition-all duration-300 shadow-2xl hover:shadow-green-500/50"
                >
                    ğŸ“± Solicitar Corrida via WhatsApp
                </button>
            </div>

            <!-- Chat e EstatÃ­sticas -->
            <div class="space-y-6">
                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-2xl font-bold text-white mb-4">ğŸ’¬ Chat ao Vivo</h3>
                    <div id="chatMessages" class="space-y-3 mb-4">
                        <div class="p-4 rounded-2xl max-w-md glass">
                            ğŸ‘¨â€ğŸ’¼ OlÃ¡! Sou o Lucas Santos, seu motorista premium. Como posso ajudar?
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            id="mensagemInput" 
                            placeholder="Digite sua mensagem..."
                            class="flex-1 px-4 py-3 rounded-xl bg-white/10 border-2 border-purple-400/30 text-white placeholder-gray-400 focus:border-purple-500 focus:outline-none"
                            onkeypress="if(event.key === 'Enter') enviarMensagem()"
                        >
                        <button 
                            onclick="enviarMensagem()" 
                            class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-xl font-semibold transition-all"
                        >
                            ğŸ“¤
                        </button>
                    </div>
                </div>

                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-2xl font-bold text-white mb-4">ğŸ“Š EstatÃ­sticas de Hoje</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="glass p-4 rounded-xl text-center">
                            <div class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                                <span id="visitantesHoje">0</span>
                            </div>
                            <div class="text-sm text-gray-300 mt-1">ğŸ‘¥ Visitantes Hoje</div>
                        </div>
                        <div class="glass p-4 rounded-xl text-center">
                            <div class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-400">
                                1.247
                            </div>
                            <div class="text-sm text-gray-300 mt-1">ğŸš— Total de Corridas</div>
                        </div>
                    </div>

                    <h4 class="text-lg font-semibold text-white mb-3">ğŸ•’ Ãšltimos Visitantes</h4>
                    <div id="listaVisitantes" class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="text-gray-400 text-center p-4">Nenhum visitante ainda</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal Admin -->
    <div id="adminModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass p-8 rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">âš™ï¸ Painel Administrativo</h2>
                <button onclick="toggleAdmin()" class="text-white text-3xl hover:text-red-400 transition-colors">
                    âœ–ï¸
                </button>
            </div>

            <div class="space-y-6">
                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold text-white mb-4">ğŸ“¸ Atualizar Foto do Perfil</h3>
                    <input 
                        type="file" 
                        id="uploadFoto" 
                        accept="image/*" 
                        class="w-full px-4 py-3 bg-white/10 border-2 border-purple-400/30 text-white rounded-xl file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700"
                    >
                    <button 
                        onclick="atualizarFoto()" 
                        class="mt-4 w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-xl font-semibold transition-all"
                    >
                        âœ… Atualizar Foto
                    </button>
                </div>

                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold text-white mb-4">ğŸ“ Registrar Novo Visitante</h3>
                    <div class="space-y-3">
                        <input 
                            type="text" 
                            id="nomeVisitante" 
                            placeholder="Nome completo"
                            class="w-full px-4 py-3 bg-white/10 border-2 border-purple-400/30 text-white placeholder-gray-400 rounded-xl focus:border-purple-500 focus:outline-none"
                        >
                        <input 
                            type="text" 
                            id="cpfVisitante" 
                            placeholder="CPF"
                            class="w-full px-4 py-3 bg-white/10 border-2 border-purple-400/30 text-white placeholder-gray-400 rounded-xl focus:border-purple-500 focus:outline-none"
                        >
                        <input 
                            type="text" 
                            id="telefoneVisitante" 
                            placeholder="Telefone"
                            class="w-full px-4 py-3 bg-white/10 border-2 border-purple-400/30 text-white placeholder-gray-400 rounded-xl focus:border-purple-500 focus:outline-none"
                        >
                        <button 
                            onclick="registrarVisitante()" 
                            class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all"
                        >
                            âœ… Registrar Visitante
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let latOrigem = null;
        let lngOrigem = null;
        let origemAtual = '';
        let destinoAtual = '';
        let distanciaCalculada = 0;
        let valorTotalCalculado = 0;
        let timeoutSugestaoOrigem = null;
        let timeoutSugestaoDestino = null;

        // Carregar dados ao iniciar
        window.onload = function() {
            carregarDados();
        };

        function carregarDados() {
            // Carregar foto
            const fotoSalva = localStorage.getItem('fotoMotorista');
            if (fotoSalva) {
                document.getElementById('fotoMotorista').src = fotoSalva;
                document.getElementById('fotoMotorista').classList.remove('hidden');
                document.getElementById('avatarPadrao').classList.add('hidden');
            }

            // Carregar visitantes
            const visitantes = JSON.parse(localStorage.getItem('visitantes') || '[]');
            const hoje = new Date().toLocaleDateString('pt-BR');
            const visitantesHoje = visitantes.filter(v => v.data.startsWith(hoje)).length;

            document.getElementById('visitantesHoje').textContent = visitantesHoje;

            const lista = document.getElementById('listaVisitantes');
            lista.innerHTML = '';
            
            visitantes.slice().reverse().slice(0, 10).forEach(v => {
                const div = document.createElement('div');
                div.className = 'glass p-3 rounded-lg';
                div.innerHTML = `
                    <div class="font-semibold text-gray-200">${v.nome}</div>
                    <div class="text-sm text-gray-400">CPF: ${v.cpf} | Tel: ${v.telefone}</div>
                    <div class="text-xs text-gray-500">Acesso: ${v.data}</div>
                `;
                lista.appendChild(div);
            });

            if (visitantes.length === 0) {
                lista.innerHTML = '<div class="text-gray-400 text-center p-4">Nenhum visitante ainda</div>';
            }
        }

        function registrarVisitante() {
            const nome = document.getElementById('nomeVisitante').value.trim();
            const cpf = document.getElementById('cpfVisitante').value.trim();
            const telefone = document.getElementById('telefoneVisitante').value.trim();

            if (!nome || !cpf || !telefone) {
                alert('âš ï¸ Preencha todos os campos!');
                return;
            }

            const visitantes = JSON.parse(localStorage.getItem('visitantes') || '[]');
            const novoVisitante = {
                nome,
                cpf,
                telefone,
                data: new Date().toLocaleString('pt-BR')
            };

            visitantes.push(novoVisitante);
            localStorage.setItem('visitantes', JSON.stringify(visitantes));

            document.getElementById('nomeVisitante').value = '';
            document.getElementById('cpfVisitante').value = '';
            document.getElementById('telefoneVisitante').value = '';

            alert('âœ… Visitante registrado com sucesso!');
            carregarDados();
        }

        function toggleAdmin() {
            document.getElementById('adminModal').classList.toggle('hidden');
        }

        function atualizarFoto() {
            const input = document.getElementById('uploadFoto');
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const foto = document.getElementById('fotoMotorista');
                    const avatar = document.getElementById('avatarPadrao');
                    foto.src = e.target.result;
                    foto.classList.remove('hidden');
                    avatar.classList.add('hidden');
                    
                    localStorage.setItem('fotoMotorista', e.target.result);
                    alert('âœ… Foto atualizada com sucesso!');
                };
                reader.readAsDataURL(file);
            } else {
                alert('âŒ Selecione uma foto primeiro!');
            }
        }

        function obterLocalizacao() {
            const status = document.getElementById('locationStatus');
            const origemInput = document.getElementById('origem');
            status.classList.remove('hidden');
            status.className = 'mt-3 p-3 glass rounded-lg text-sm text-cyan-300';
            status.textContent = 'ğŸ”„ Obtendo sua localizaÃ§Ã£o...';
            
            if (!navigator.geolocation) {
                status.className = 'mt-3 p-3 glass rounded-lg text-sm text-red-300';
                status.textContent = 'âŒ GeolocalizaÃ§Ã£o nÃ£o suportada pelo navegador';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    latOrigem = position.coords.latitude;
                    lngOrigem = position.coords.longitude;
                    
                    status.textContent = 'ğŸ”„ Buscando endereÃ§o...';
                    
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latOrigem}&lon=${lngOrigem}&accept-language=pt-BR`);
                        const data = await response.json();
                        
                        const endereco = data.address;
                        let enderecoFormatado = '';
                        
                        if (endereco.road) {
                            enderecoFormatado = endereco.road;
                            if (endereco.house_number) enderecoFormatado += ', ' + endereco.house_number;
                            if (endereco.suburb || endereco.neighbourhood) enderecoFormatado += ' - ' + (endereco.suburb || endereco.neighbourhood);
                            if (endereco.city || endereco.town) enderecoFormatado += ', ' + (endereco.city || endereco.town);
                            if (endereco.state) enderecoFormatado += ' - ' + endereco.state;
                        } else {
                            enderecoFormatado = data.display_name;
                        }
                        
                        origemInput.value = enderecoFormatado;
                        status.className = 'mt-3 p-3 glass rounded-lg text-sm text-green-300';
                        status.textContent = 'âœ… LocalizaÃ§Ã£o obtida: ' + enderecoFormatado;
                        setTimeout(() => status.classList.add('hidden'), 5000);
                    } catch (error) {
                        origemInput.value = `${latOrigem.toFixed(6)}, ${lngOrigem.toFixed(6)}`;
                        status.className = 'mt-3 p-3 glass rounded-lg text-sm text-yellow-300';
                        status.textContent = 'âš ï¸ LocalizaÃ§Ã£o obtida (coordenadas)';
                        setTimeout(() => status.classList.add('hidden'), 3000);
                    }
                },
                (error) => {
                    status.className = 'mt-3 p-3 glass rounded-lg text-sm text-red-300';
                    status.textContent = 'âŒ Erro ao obter localizaÃ§Ã£o. Ative a permissÃ£o no navegador.';
                }
            );
        }

        function abrirGoogleMaps() {
            const destino = document.getElementById('destino').value;
            const origem = document.getElementById('origem').value;
            
            if (!destino) {
                alert('âŒ Digite o endereÃ§o de destino primeiro!');
                return;
            }
            
            let url;
            
            if (latOrigem && lngOrigem) {
                url = `https://www.google.com/maps/dir/${latOrigem},${lngOrigem}/${encodeURIComponent(destino)}`;
            } else if (origem && origem.trim() !== '') {
                url = `https://www.google.com/maps/dir/${encodeURIComponent(origem)}/${encodeURIComponent(destino)}`;
            } else {
                url = `https://www.google.com/maps/search/${encodeURIComponent(destino)}`;
            }
            
            window.open(url, '_blank');
        }

        function abrirWaze() {
            const destino = document.getElementById('destino').value;
            const origem = document.getElementById('origem').value;
            
            if (!destino) {
                alert('âŒ Digite o endereÃ§o de destino primeiro!');
                return;
            }
            
            let url;
            
            if (latOrigem && lngOrigem) {
                url = `https://waze.com/ul?ll=${latOrigem},${lngOrigem}&navigate=yes&q=${encodeURIComponent(destino)}`;
            } else if (origem && origem.trim() !== '') {
                url = `https://waze.com/ul?q=${encodeURIComponent(destino)}&navigate=yes`;
            } else {
                url = `https://waze.com/ul?q=${encodeURIComponent(destino)}`;
            }
            
            window.open(url, '_blank');
        }

        async function calcularRota() {
            const origem = document.getElementById('origem').value;
            const destino = document.getElementById('destino').value;

            if (!origem || !destino) {
                alert('âš ï¸ Por favor, preencha origem e destino!');
                return;
            }

            origemAtual = origem;
            destinoAtual = destino;

            document.getElementById('resultadoPreco').classList.remove('hidden');
            document.getElementById('distanciaTexto').textContent = 'Calculando...';
            document.getElementById('distanciaTexto').classList.add('loading-pulse');
            document.getElementById('valorTotal').textContent = 'R$ --';

            try {
                const origemCoords = await geocodificar(origem);
                const destinoCoords = await geocodificar(destino);

                if (!origemCoords || !destinoCoords) {
                    throw new Error('NÃ£o foi possÃ­vel localizar os endereÃ§os');
                }

                const response = await fetch(
                    `https://router.project-osrm.org/route/v1/driving/${origemCoords.lon},${origemCoords.lat};${destinoCoords.lon},${destinoCoords.lat}?overview=false`
                );
                const data = await response.json();

                if (data.code !== 'Ok') {
                    throw new Error('NÃ£o foi possÃ­vel calcular a rota');
                }

                const distanciaMetros = data.routes[0].distance;
                const km = Math.round(distanciaMetros / 1000);

                const estadoOrigem = await obterEstado(origemCoords.lat, origemCoords.lon);
                const estadoDestino = await obterEstado(destinoCoords.lat, destinoCoords.lon);
                
                const foraDoES = estadoOrigem !== 'EspÃ­rito Santo' || estadoDestino !== 'EspÃ­rito Santo';
                const valorPorKm = foraDoES ? 4.00 : 3.00;

                const total = km * valorPorKm;

                distanciaCalculada = km;
                valorTotalCalculado = total;

                document.getElementById('distanciaTexto').classList.remove('loading-pulse');
                document.getElementById('distanciaTexto').textContent = km + ' km';
                document.getElementById('taxaDescricao').textContent = foraDoES 
                    ? 'ğŸ’° Valor por km (Fora do ES): R$ 4,00/km' 
                    : 'ğŸ’° Valor por km (ES): R$ 3,00/km';
                document.getElementById('valorKm').textContent = 'R$ ' + (km * valorPorKm).toFixed(2);
                document.getElementById('valorTotal').textContent = 'R$ ' + total.toFixed(2);
                document.getElementById('valorPagamento').textContent = 'R$ ' + total.toFixed(2);
                document.getElementById('secaoPagamento').classList.remove('hidden');
                document.getElementById('btnWhatsApp').classList.remove('hidden');

                const tipoViagem = foraDoES ? 'Fora do EspÃ­rito Santo' : 'EspÃ­rito Santo';
                adicionarMensagemChat('driver', `âœ… Rota calculada! DistÃ¢ncia: ${km} km (${tipoViagem}). Valor: R$ ${total.toFixed(2)} (R$ ${valorPorKm.toFixed(2)}/km). Pagamento direto ao motorista ou via PIX.`);
            } catch (error) {
                document.getElementById('distanciaTexto').classList.remove('loading-pulse');
                alert('âŒ Erro ao calcular rota. Verifique os endereÃ§os e tente novamente.');
                document.getElementById('resultadoPreco').classList.add('hidden');
            }
        }

        async function geocodificar(endereco) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endereco)}&limit=1&accept-language=pt-BR`
                );
                const data = await response.json();
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lon: parseFloat(data[0].lon)
                    };
                }
                return null;
            } catch (error) {
                return null;
            }
        }

        async function obterEstado(lat, lon) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=pt-BR`
                );
                const data = await response.json();
                return data.address?.state || '';
            } catch (error) {
                return '';
            }
        }

        function copiarPix() {
            const chavePix = '14712258799';
            navigator.clipboard.writeText(chavePix).then(() => {
                alert('âœ… Chave PIX copiada com sucesso!\n\nğŸ“‹ ' + chavePix);
            }).catch(() => {
                alert('ğŸ“‹ Chave PIX: ' + chavePix + '\n\nCopie manualmente esta chave.');
            });
        }

        function confirmarPagamento() {
            alert('âœ… Pagamento confirmado! VocÃª pode enviar a solicitaÃ§Ã£o pelo WhatsApp agora.');
            document.getElementById('secaoPagamento').style.opacity = '0.6';
            adicionarMensagemChat('driver', 'âœ… Pagamento PIX confirmado! Obrigado pela preferÃªncia.');
        }

        function enviarMensagem() {
            const input = document.getElementById('mensagemInput');
            const mensagem = input.value.trim();
            
            if (!mensagem) return;

            adicionarMensagemChat('user', mensagem);
            input.value = '';

            setTimeout(() => {
                adicionarMensagemChat('driver', 'âœ… Mensagem recebida! Para solicitar uma corrida, use o formulÃ¡rio acima e calcule o valor.');
            }, 500);
        }

        function enviarWhatsApp() {
            const pagamentoPix = document.getElementById('secaoPagamento').style.opacity === '0.6' ? 'Sim' : 'NÃ£o confirmado';
            
            const mensagem = `ğŸš— *Nova SolicitaÃ§Ã£o de Corrida Premium*

ğŸ‘¤ *Motorista:* Lucas Santos
ğŸ“ *Origem:* ${origemAtual}
ğŸ¯ *Destino:* ${destinoAtual}
ğŸ“ *DistÃ¢ncia:* ${distanciaCalculada} km
ğŸ’° *Valor:* R$ ${valorTotalCalculado.toFixed(2)}

ğŸ’³ *Pagamento PIX antecipado:* ${pagamentoPix}
${pagamentoPix === 'Sim' ? 'âœ… Chave PIX: 147.122.587-99' : 'ğŸ’µ Pagamento direto ao motorista'}

---
ğŸŒŸ ServiÃ§o Premium de Transporte
â­â­â­â­â­ AvaliaÃ§Ã£o 5 Estrelas | 1.247 corridas realizadas`;

            const url = `https://wa.me/5527988668504?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
            
            adicionarMensagemChat('driver', 'âœ… Redirecionando para WhatsApp... Aguarde o contato do motorista Lucas Santos!');
        }

        function adicionarMensagemChat(tipo, texto) {
            const chat = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = tipo === 'user' 
                ? 'p-4 rounded-2xl max-w-md bg-gradient-to-r from-purple-600 to-pink-600 text-white ml-auto text-right border border-purple-400/30 shadow-lg' 
                : 'p-4 rounded-2xl max-w-md glass';
            div.textContent = (tipo === 'user' ? 'ğŸ‘¤ ' : 'ğŸ‘¨â€ğŸ’¼ ') + texto;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function buscarSugestoesOrigem(valor) {
            clearTimeout(timeoutSugestaoOrigem);
            
            if (valor.length < 3) {
                document.getElementById('sugestoesOrigem').classList.add('hidden');
                return;
            }

            timeoutSugestaoOrigem = setTimeout(async () => {
                await buscarSugestoes(valor, 'sugestoesOrigem', 'origem');
            }, 500);
        }

        function buscarSugestoesDestino(valor) {
            clearTimeout(timeoutSugestaoDestino);
            
            if (valor.length < 3) {
                document.getElementById('sugestoesDestino').classList.add('hidden');
                return;
            }

            timeoutSugestaoDestino = setTimeout(async () => {
                await buscarSugestoes(valor, 'sugestoesDestino', 'destino');
            }, 500);
        }

        async function buscarSugestoes(query, elementoId, inputId) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&accept-language=pt-BR&countrycodes=br`
                );
                const resultados = await response.json();

                const container = document.getElementById(elementoId);
                container.innerHTML = '';

                if (resultados.length === 0) {
                    container.classList.add('hidden');
                    return;
                }

                resultados.forEach(resultado => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item px-4 py-3 hover:bg-white/20 cursor-pointer transition-all border-b border-white/10 last:border-0';
                    
                    const endereco = resultado.display_name;
                    const icone = resultado.type === 'city' || resultado.type === 'town' ? 'ğŸ™ï¸' : 
                                  resultado.type === 'suburb' || resultado.type === 'neighbourhood' ? 'ğŸ˜ï¸' : 'ğŸ“';
                    
                    div.innerHTML = `
                        <div class="flex items-start gap-2">
                            <span class="text-xl">${icone}</span>
                            <div class="flex-1">
                                <div class="text-white font-medium text-sm">${endereco.split(',')[0]}</div>
                                <div class="text-gray-400 text-xs mt-1">${endereco}</div>
                            </div>
                        </div>
                    `;
                    
                    div.onclick = () => {
                        document.getElementById(inputId).value = endereco;
                        container.classList.add('hidden');
                        
                        if (inputId === 'origem') {
                            latOrigem = parseFloat(resultado.lat);
                            lngOrigem = parseFloat(resultado.lon);
                        }
                    };
                    
                    container.appendChild(div);
                });

                container.classList.remove('hidden');
            } catch (error) {
                console.error('Erro ao buscar sugestÃµes:', error);
            }
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#origem') && !e.target.closest('#sugestoesOrigem')) {
                document.getElementById('sugestoesOrigem').classList.add('hidden');
            }
            if (!e.target.closest('#destino') && !e.target.closest('#sugestoesDestino')) {
                document.getElementById('sugestoesDestino').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
